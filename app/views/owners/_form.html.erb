<%# decor/app/views/owners/_form.html.erb - version 1.2 %>
<%# Added password generator button (line 69-72) %>
<%# Password generator uses Stimulus controller to create secure 16-character password %>
<%# Requires current password verification for security %>
<%# Password fields are optional - leave blank to skip password change %>

<%= form_with model: owner, class: "space-y-4" do |f| %>
  <%= render "common/record_errors", record: owner %>

  <div>
    <%= f.label :user_name, class: "block text-sm font-medium text-stone-700" %>
    <%= f.text_field :user_name, class: field_classes %>
  </div>

  <div class="grid grid-cols-3 gap-4 items-end">
    <div class="col-span-2">
      <%= f.label :real_name, class: "block text-sm font-medium text-stone-700" %>
      <%= f.text_field :real_name, class: field_classes %>
    </div>
    <div>
      <%= f.label :real_name_visibility, "Visibility", class: "block text-sm font-medium text-stone-700" %>
      <%= f.select :real_name_visibility, Owner.real_name_visibilities.keys.map { |v| [v.titleize, v] }, {}, class: field_classes %>
    </div>
  </div>

  <div class="grid grid-cols-3 gap-4 items-end">
    <div class="col-span-2">
      <%= f.label :email, class: "block text-sm font-medium text-stone-700" %>
      <%= f.email_field :email, class: field_classes %>
    </div>
    <div>
      <%= f.label :email_visibility, "Visibility", class: "block text-sm font-medium text-stone-700" %>
      <%= f.select :email_visibility, Owner.email_visibilities.keys.map { |v| [v.titleize, v] }, {}, class: field_classes %>
    </div>
  </div>

  <div class="grid grid-cols-3 gap-4 items-end">
    <div class="col-span-2">
      <%= f.label :country, class: "block text-sm font-medium text-stone-700" %>
      <%= f.select :country, Owner.countries_for_select, { include_blank: "Select a country" }, class: field_classes %>
    </div>
    <div>
      <%= f.label :country_visibility, "Visibility", class: "block text-sm font-medium text-stone-700" %>
      <%= f.select :country_visibility, Owner.country_visibilities.keys.map { |v| [v.titleize, v] }, {}, class: field_classes %>
    </div>
  </div>

  <div>
    <%= f.label :website, class: "block text-sm font-medium text-stone-700" %>
    <%= f.url_field :website, placeholder: "https://example.com", class: field_classes %>
  </div>

  <%# Password Change Section - Optional %>
  <%# User must provide current password to change to new password %>
  <%# Leave all password fields blank to update profile without changing password %>
  <div class="border-t border-stone-200 pt-4 mt-6" data-controller="password-generator">
    <h2 class="text-lg font-medium text-stone-900 mb-4">Change Password</h2>
    <p class="text-sm text-stone-600 mb-4">Leave blank if you don't want to change your password.</p>
    
    <div>
      <%= f.label :current_password, "Current Password", class: "block text-sm font-medium text-stone-700" %>
      <%= f.password_field :current_password, autocomplete: "current-password", class: field_classes %>
      <p class="text-xs text-stone-500 mt-1">Required to change your password</p>
    </div>

    <div>
      <%= f.label :password, "New Password", class: "block text-sm font-medium text-stone-700" %>
      <%= f.password_field :password, autocomplete: "new-password", class: field_classes, data: { password_generator_target: "password" } %>
      <button type="button" data-action="password-generator#generate" class="mt-2 text-sm text-indigo-600 hover:text-indigo-900 font-medium">
        Generate Secure Password
      </button>
      <p class="text-xs text-stone-500 mt-1">Minimum 12 characters. Using a generated password is recommended for security.</p>
    </div>

    <div>
      <%= f.label :password_confirmation, "Confirm New Password", class: "block text-sm font-medium text-stone-700" %>
      <%= f.password_field :password_confirmation, autocomplete: "new-password", class: field_classes, data: { password_generator_target: "confirmation" } %>
    </div>
  </div>

  <div class="flex gap-3">
    <%= f.submit class: button_classes(style: :primary) %>
    <%= link_to "Cancel", owner, class: button_classes(style: :secondary) %>
  </div>
<% end %>
